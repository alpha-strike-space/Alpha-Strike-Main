<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8"/>
    	<meta name="description" content="The Alpha-Strike Leaderboard or Killboard for Eve Frontier">
    	<meta name="keywords" content="Eve Frontier, PVP, Leaderboard, Killboard">
    	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    	<title>Alpha-Strike, Find your Content on the Frontier!</title>
    	<link rel="shortcut icon" href="favicon.png">
	<style>
	/* Base styles for the top navigation */
	.topnav {
    		display: flex;
    		align-items: center; /* Center items vertically */
    		background-color: #98888e;  /* Background color */
    		padding: 0 10px;         /* Side padding */
	}
	/* Navigation links */	
	.topnav a {
		color: #d1bea8;
	    	text-align: center;
    		padding: 14px 16px;
    		text-decoration: none;
	}
	/* Active link styling */
	.topnav a.active {
		background-color: #f08080;
    		color: #000;
	}
	/* Hover effect for links */
	.topnav a:hover {
	    	background-color: #f08080;
	    	color: #000;
    		transform: scale(1.05); /* Slight enlargement */
    		box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
	}
	/* Push the last element (if needed) to the far right on larger screens */
	.topnav a:last-child {
	    	margin-left: auto;
	}
	/* Language button animation */
	#animatedLangBtn {
  		margin-left: auto; /* Pushes the button to the right */
  		padding: 14px 16px; /* Match nav link padding for a larger, well-sized button */
  		font-size: 1rem; /* Increase font size for desktop */
		background-color: #98888e;
  		color: #d1bea8;
  		border: none;
  		//border-radius: 4px;
  		cursor: pointer;
  		opacity: 1;
  		transition: opacity 0.5s ease, background-color 0.3s ease,
              	transform 0.3s ease, box-shadow 0.3s ease;
	}
    	#animatedLangBtn:hover {
      		background-color: #f08080;
	    	color: #000;
    		transform: scale(1.05); /* Slight enlargement */
    		box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
    	}
    	/* Remove default margins and paddings */
    	body {
      		/* Set the background image - update the URL to your image */
      		background-image: url('blackhole.jpg');
      		/* Ensure the image covers the entire viewport */
     	 	background-size: cover;
      		/* Center the image horizontally and vertically */
      		background-position: center;
      		/* Prevent the image from repeating */
      		background-repeat: no-repeat;
      		/* Optional: keep the background fixed while scrolling */
      		background-attachment: fixed;
    	}
    	/* Main Container */
    	.container {
      		max-width: 800px;
      		margin: 20px auto;
      		padding: 20px;
  		/* Using RGBA so only the background is semi-transparent */
  		background-color: rgba(255, 255, 255, 0.6);
      		border-radius: 8px;
    	  	box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    	}
    	h1 {
      		text-align: center;
      		color: #d1bea8;
      		margin-bottom: 30px;
    	}
    	/* Data Card for Search Results */
    	.data-card {
  		background-color: rgba(249, 249, 249, 0.7); /* 90% opaque light grey */
      		border: 1px solid #ddd;
      		padding: 15px;
      		margin-bottom: 15px;
      		border-radius: 5px;
    	}
    	.data-card h2 {
      		margin-top: 0;
      		font-size: 1.2rem;
      		color: #222;
    	}
    	.data-card p {
      		margin: 5px 0;
      		font-size: 0.9rem;
    	  	color: #555;
    	}
    	.timestamp {
      		font-style: italic;
      		color: #888;
      		font-size: 0.8rem;
     		margin-top: 10px;
    	}	
	/* Victims get a blood color (dark red) */
	.victim {
 	 	color: #8B0000;
	}
	/* Killers get a gold color */
	.killer {
		color: #d24e01;
	}
	/* Mobile responsive: Vertical stacking for the navigation */
	@media screen and (max-width: 600px) {
		/* Prevent background scroll when selecting language in mobile view */
  		body {
    			background-attachment: scroll;  /* Let the background scroll on mobile */
  		}
    		.topnav {
        		flex-direction: column; /* Stack items vertically */
        		align-items: stretch;   /* Make each link fill the container width */
        		padding: 0;             /* Adjust padding on mobile if necessary */
    		}
    		.topnav a {
        		display: block;
        		text-align: left;       /* Left-align text or use center for a different style */
        		padding: 12px;          /* Adjust link padding for easier tapping */
        		margin: 0;              /* Remove any margin that might disrupt the layout */
        		border-bottom: 1px solid #ddd;  /* Optional divider between links */
    		}
    		/* Remove the extra margin on the last child and its divider line */
    		.topnav a:last-child {
        		margin-left: 0;
        		border-bottom: none;
    		}
  		#animatedLangBtn {
    			display: flex;      /* Make it a block-level element */
    			width: 100%;         /* Fill its container's width */
    			padding: 14px 16px;  /* Match the nav link padding */
    			text-align: center;
    			color: #d1bea8;
			background-color: #98888e;
    			border: none;
    			border-radius: 0;    /* Optionally, remove border radius */
    			cursor: pointer;
  		}
	}
	</style>
</head>
<body>		
	<!-- Top Navigation Bar with Language Switcher -->
	<div class="topnav">
		<a class="active" href="main.html" data-translate="navbar.home">Recently Stamped</a>
		<a href="monthly_killers.html" data-translate="navbar.killers">Leading Killers</a>
		<a href="monthly_systems.html" data-translate="navbar.systems">Leading Systems</a>
		<a href="monthly_victims.html" data-translate="navbar.victims">Leading Victims</a>
		<a href="search.html" data-translate="navbar.search">Search</a>
    		<!-- One animated button that cycles through language options -->
    		<button id="animatedLangBtn">EN</button>
  	</div>
	<h1 data-translate="page.stamped-header">Recently Stamped Mails</h1>
	<div id="data-container" class="container">
	
	</div>
    	<script type="text/javascript" src="translation_dictionary.js">
    		/* Nothing to add here, just calling a script */
	</script> 
	<script>
    	/** Function to format the timestamp if needed.
    	* Check your API docs to understand the timestamp's unit.
	*/
	function formatTimestamp(ldapTimestamp) {
		// Convert the LDAP timestamp (in 100-nanosecond intervals) to milliseconds since 1601
  		const msSince1601 = ldapTimestamp / 10000;
  	  	// Calculate the difference between Jan 1, 1601 and Jan 1, 1970 in milliseconds
  		const epochDifference = 11644473600000; // 11,644,473,600,000 ms
 	 	// Convert to Unix timestamp in milliseconds (since Jan 1, 1970)
 	 	const msSince1970 = msSince1601 - epochDifference;
  		// Create a new Date object and return its UTC string representation
 	 	return new Date(msSince1970).toUTCString();
	}
    	// Function to display the data on the page
	function displayData(data) {
		const container = document.getElementById("data-container");
      		container.innerHTML = ""; // Clear previous content
	        // Sort by the LDAP timestamp in descending order (most recent first)
	        data.sort((a, b) => b.time_stamp - a.time_stamp);
       		// Slice the first 100 records after sorting.
       		const latest100 = data.slice(0, 100);
      		// Loop through the array, even if it contains one object
      		latest100.forEach(item => {
        	// Create a new div for this data item
        	const itemDiv = document.createElement("div");
        	itemDiv.classList.add("data-card");
        	// Build HTML using the keys from your data object
       	 	itemDiv.innerHTML = `
          			<h2>
					<span class="killer">${item.killer_name}</span>
					<img src="pew.png" alt="vs" style="height:20px; vertical-align:middle;" />
 					<span class="victim">${item.victim_name}</span>
				</h2>
          			<p><strong data-translate="card.lossType">Loss Type:</strong> ${item.loss_type}</p>
          			<p><strong data-translate="card.solarSystem">Solar System:</strong> ${item.solar_system_name} (ID: ${item.solar_system_id})</p>
          			<p class="timestamp"><strong data-translate="card.timestamp">Timestamp:</strong> ${formatTimestamp(item.time_stamp)}</p>
        		`;
        		container.appendChild(itemDiv);
			// After creating the cards, update translations using the current language.
      			const currentLang = localStorage.getItem("preferredLanguage") || "en";
      			setLanguage(currentLang);
      		});
	}
	// --- Option 2: Fetch data from an API endpoint ---
	async function fetchAndDisplayData() {
		try {
        		// Replace with your API endpoint
        		const response = await fetch('https://api.alpha-strike.space/incident?filter=month');
        		if (!response.ok) {
        		  throw new Error(`HTTP error! Status: ${response.status}`);
        		}
        		// Parse the returned JSON data; it will be an array of objects
        		const data = await response.json();
        		displayData(data);
      		} catch (error) {
        		console.error('Error fetching data:', error);
        		document.getElementById("data-container").textContent = "Failed to load data.";
      		}
	}
	// Call fetchData once the page has loaded
	fetchAndDisplayData();
	// Websocket
    	function setupWebSocket() {
      		// Replace with your actual WebSocket endpoint (must use "ws://" or "wss://")
      		const ws = new WebSocket('wss://api.alpha-strike.space/ws/mails'); 
      		// Create connection
      		ws.onopen = function() {
        		console.log('WebSocket connection established.');
      		};
		// Recieve messages.
     		ws.onmessage = function(event) {
        		try {
				try {
				        // Assume the incoming message is a single JSON object
          				const newItem = JSON.parse(event.data);
          				// Create a new card for the new item
          				const card = document.createElement("div");
          				card.classList.add("data-card");
          				card.innerHTML = `
            					<h2>
							<span class="killer">${newItem.killer_name}</span>
							<img src="pew.png" alt="vs" style="height:20px; vertical-align:middle;" />
							<span class="victim">${newItem.victim_name}</span>
						</h2>
            					<p><strong>Loss Type:</strong> ${newItem.loss_type}</p>
            					<p><strong>Solar System:</strong> ${newItem.solar_system_name} (ID: ${newItem.solar_system_id})</p>
            					<p><strong>Timestamp:</strong> ${formatTimestamp(newItem.time_stamp)}</p>
          				`;
          				// Prepend the new card at the top of the container
          				const container = document.getElementById("data-card");
          				container.insertBefore(card, container.firstChild);
    				} catch (error) {
        				console.warn("Received non-mail JSON message:", event.data);
    				}
        		} catch (error) {
          			console.error('Error processing WebSocket message:', error);
        		}
      		};
		// Get errors.
      		ws.onerror = function(error) {
        		console.error('WebSocket error:', error);
      		};
		// Close connection when done.
      		ws.onclose = function() {
        		console.log('WebSocket connection closed. Attempting a reconnect.');
    			setTimeout(setupWebSocket, 5000); // Try to reconnect after 5 seconds.
        		// Optionally, implement reconnection logic here.
      		};
    	}
    	// Open the WebSocket connection to listen for live updates.
    	setupWebSocket();
	</script>
</body>
</html>
