// Translation dictionary for selected elements.
// Translation dictionary for selected elements.
const translations = {
      	"navbar.home": { 
        	en: "Recently Stamped", 
        	ru: "Недавно Отмечено", 
        	zh: "最近盖章", 
       	 	es: "Recientemente Sellado" 
      	},
      	"navbar.killers": { 
        	en: "Leading Killers", 
        	ru: "Лидирующие Убийцы", 
        	zh: "领先杀手", 
        	es: "Principales Asesinos" 
      	},
      	"navbar.systems": { 
        	en: "Leading Systems", 
        	ru: "Лидирующие Системы", 
        	zh: "领先系统", 
        	es: "Principales Sistemas" 
      	},
      	"navbar.victims": { 
        	en: "Leading Victims", 
        	ru: "Лидирующие Жертвы", 
        	zh: "领先受害者", 
        	es: "Principales Víctimas" 
      	},
      	"navbar.search": { 
        	en: "Search", 
        	ru: "Поиск", 
        	zh: "搜索", 
        	es: "Buscar" 
      	},
	// Headers:
      	"page.search-header": { 
        	en: "Search Stamped Mails", 
        	ru: "Поиск Отмеченных Писем", 
        	zh: "搜索盖章邮件", 
        	es: "Buscar Correos Sellados" 
      	},
	"page.stamped-header": {
		en: "Recently Stamped Mails",
		ru: "Недавно Запечатленные Письма",
		zh: "最近盖章邮件",
		es: "Correos Sellados Recientemente" 
	},
	// Totals and labels:
      	"header.tenaciousKillers": {
		en: "Tenacious Killers",
		ru: "Упорные Убийцы",
		zh: "顽强杀手",
		es: "Asesinos Tenaces"
	},
      	"table.name": {
		en: "Name",
		ru: "Имя",
		zh: "姓名",
		es: "Nombre"
	},
      	"table.numVictimsStacked": {
		en: "Number of Victims Stacked",
		ru: "Количество накопленных жертв",
		zh: "堆叠的受害者数量",
		es: "Número de Víctimas Acumuladas" },
      	"header.defeatedVictims": {
		en: "Defeated Victims",
		ru: "Побеждённые Жертвы",
	        zh: "被击败的受害者",
		es: "Víctimas Derrotadas"
	},
     	"table.numAwakenings": {
	 	en: "Number of Awakenings",
		ru: "Количество Пробуждений",
	    	zh: "觉醒次数",
	        es: "Número de Despertares"
	},
	"header.leadingSystemsByIncidents": {
 		en: "Leading Systems by Incidents",
		ru: "Ведущие Системы по Инцидентам",
		zh: "基于事件的领先系统",
	 	es: "Sistemas Líderes por Incidentes"
	},
	"table.numIncidents": {
	 	en: "Number of Incidents",
		ru: "Количество Инцидентов",
		zh: "事件数量",
		es: "Número de Incidentes"
	},
  	"header.rollingMonthly": { 
    		en: "Rolling Monthly Average", 
    		ru: "Скользящее среднее за месяц", 
    		zh: "滚动月平均", 
    		es: "Promedio Mensual Móvil"
	},
	// Search functions:
      	"search.byName": { 
        	en: "Search by Name", 
        	ru: "Поиск по имени", 
        	zh: "按名称搜索", 
        	es: "Buscar por Nombre" 
      	},
      	"search.bySystem": { 
        	en: "Search by System", 
        	ru: "Поиск по системе", 
        	zh: "按系统搜索", 
        	es: "Buscar por Sistema" 
      	},
      	"search.placeholder": { 
        	en: "Enter search query...", 
        	ru: "Введите запрос...", 
        	zh: "输入搜索内容...", 
        	es: "Introduzca la consulta..." 
      	},
      	"search.button": { 
        	en: "Search", 
        	ru: "Поиск", 
        	zh: "搜索", 
        	es: "Buscar" 
      	},
      	"search-results.header": { 
        	en: "Search Results", 
        	ru: "Результаты поиска", 
        	zh: "搜索结果", 
        	es: "Resultados de la Búsqueda" 
      	},
	// Search errors:
	"search.error": {
		en: "Error fetching search results. Please check your query.", 
                ru: "Ошибка при получении результатов поиска. Пожалуйста, проверьте запрос.", 
                zh: "获取搜索结果时出错。请检查您的查询。", 
                es: "Error al obtener los resultados de búsqueda. Por favor, revise su consulta."
	},
      	// Keys for card labels:
      	"card.lossType": { 
        	en: "Loss Type:", 
        	ru: "Тип потерь:", 
        	zh: "损失类型:", 
        	es: "Tipo de Pérdida:" 
      	},
      	"card.solarSystem": { 
        	en: "Solar System:", 
        	ru: "Солнечная система:", 
        	zh: "太阳系:", 
        	es: "Sistema Solar:" 
      	},
      	"card.timestamp": { 
        	en: "Timestamp:", 
        	ru: "Время:", 
        	zh: "时间戳:", 
        	es: "Marca de Tiempo:" 
      	},
  	"card.totalVictims": {
    		en: "Total Victims:",
    		ru: "Общее число жертв:",
    		zh: "总受害者:",
    		es: "Total de víctimas:"
  	},
  	"card.totalAwakenings": {
    		en: "Total Awakenings:",
    		ru: "Всего пробуждений:",
    		zh: "总觉醒数:",
    		es: "Total de despertares:"
  	},
  	"card.solarSystemID": {
    		en: "Solar System ID:",
    		ru: "ID звездной системы:",
    		zh: "太阳系编号:",
    		es: "ID del sistema solar:"
  	},
  	"card.incidentCount": {
    		en: "Incident Count:",
    		ru: "Количество инцидентов:",
    		zh: "事件数量:",
    		es: "Cantidad de incidentes:"
  	},
	"card.combatIncident": {
            en: "COMBAT INCIDENT",
            ru: "БОЕВОЙ ИНЦИДЕНТ",
            zh: "战斗事件",
            es: "INCIDENTE DE COMBATE"
        },
        "card.idLabel": {
            en: "ID:",
            ru: "ID:",
            zh: "ID:",
            es: "ID:"
        },
        "card.aggressor": {
            en: "AGGRESSOR",
            ru: "АТАКУЮЩИЙ", // "Attacker"
            zh: "攻击方",     // "Attacking Side"
            es: "AGRESOR"
        },
        "card.casualty": {
            en: "CASUALTY",
            ru: "ПОСТРАДАВШИЙ", // "The one who suffered/casualty"
            zh: "受损方",       // "Damaged Party / Casualty Side"
            es: "BAJA"          // "Casualty (military term)"
        },
        "card.location": {
            en: "LOCATION:",
            ru: "МЕСТОПОЛОЖЕНИЕ:",
            zh: "地点:",
            es: "UBICACIÓN:"
        },
        "card.hostileActivity": {
            en: "HOSTILE ACTIVITY CONFIRMED",
            ru: "ВРАЖДЕБНАЯ АКТИВНОСТЬ ПОДТВЕРЖДЕНА",
            zh: "已确认敌对活动",
            es: "ACTIVIDAD HOSTIL CONFIRMADA"
        },
        "card.localTimeLabel": {
            en: "LOCAL TIME:",
            ru: "МЕСТНОЕ ВРЕМЯ:",
            zh: "当地时间:",
            es: "HORA LOCAL:"
        },
        "card.utcTimeLabel": {
            en: "UTC TIME:",
            ru: "ВРЕМЯ UTC:",
            zh: "UTC 时间:",
            es: "HORA UTC:"
        },
		"card.combatPilot": {
        en: "Combat Pilot",
        ru: "Боевой пилот",
        zh: "战斗飞行员",
        es: "Piloto de Combate"
    },
    "card.kdRatio": {
        en: "K/D Ratio",
        ru: "Соотношение У/С",
        zh: "击杀死亡比",
        es: "Ratio K/D"
    },
    "card.winRate": {
        en: "Win Rate",
        ru: "Процент побед",
        zh: "胜率",
        es: "Tasa de Victoria"
    },
    "card.totalEngagements": {
        en: "Total Engagements",
        ru: "Всего боев",
        zh: "总交战次数",
        es: "Enfrentamientos Totales"
    },
    "card.threatLevel": {
        en: "Threat Level",
        ru: "Уровень угрозы",
        zh: "威胁等级",
        es: "Nivel de Amenaza"
    },
    "card.avgPerDay": {
        en: "Avg/Day",
        ru: "Среднее/День",
        zh: "平均/天",
        es: "Promedio/Día"
    },
    "card.activeDays": {
        en: "Active Days",
        ru: "Активные дни",
        zh: "活跃天数",
        es: "Días Activos"
    },
    "card.region": {
        en: "Region",
        ru: "Регион",
        zh: "区域",
        es: "Región"
    }
      	// Extend further as needed...
};

const languages = ['en', 'es', 'ru', 'zh'];

/**
 * Sets the language for the page and updates UI elements.
 */
function setLanguage(lang) {
    document.documentElement.lang = lang;
    localStorage.setItem("preferredLanguage", lang);

    const elements = document.querySelectorAll("[data-translate]");
    [...elements].map((element) => {
        const key = element.getAttribute("data-translate");
        // Navigate through nested keys if necessary (e.g., "navbar.home")
		// Access the translation object for the given key first, then get the specific language string.
		const translationEntry = translations[key];
        const translation = translationEntry ? translationEntry[lang] : undefined;

        if (translation) {
            // Preserve child elements like <img> by setting textContent only on text nodes
            // or by being more specific if the element is known to only contain text.
            if (element.childNodes.length === 1 && element.childNodes[0].nodeType === Node.TEXT_NODE) {
                element.textContent = translation;
            } else {
                // For more complex elements, you might need a more sophisticated update strategy
                // or ensure data-translate is on the innermost text-bearing element.
                // As a fallback, this might replace child elements if not handled carefully.
                // A common practice is to have a specific span for text: <a data-translate-key="navbar.home"><span>Home</span></a>
                // For now, let's assume direct text content or that your structure handles it.
                if (element.tagName === 'INPUT' || element.tagName === 'BUTTON') {
					if (element.placeholder !== undefined && (key.includes(".placeholder") || key.includes("search.placeholder"))) {
						element.placeholder = translation;
					} else {
						element.textContent = translation;
					}
				} else {
					element.innerHTML = translation; 
				}
            }
        }
    });

    // Update the language button text
    const langBtn = document.getElementById('animatedLangBtn');
    if (langBtn) {
        langBtn.innerHTML = `<i class="fas fa-globe"></i> ${lang.toUpperCase()}`;
    }

    // Update currentLanguageIndex based on the set language
    const langIndex = languages.indexOf(lang);
    if (langIndex !== -1) {
        currentLanguageIndex = langIndex;
    }
}

/**
 * Cycles to the next language and applies it.
 */
function cycleLanguage() {
    currentLanguageIndex = (currentLanguageIndex + 1) % languages.length;
    const nextLang = languages[currentLanguageIndex];
    setLanguage(nextLang);
}

/**
 * Initializes the language switcher button.
 * This function will be called after the navigation is rendered.
 */
function initializeLanguageSwitcher() {
    const animatedBtn = document.getElementById('animatedLangBtn');
    if (animatedBtn) {
        // Set initial button text from localStorage or default
        const lang = localStorage.getItem("preferredLanguage") || languages[0];
        animatedBtn.innerHTML = `<i class="fas fa-globe"></i> ${lang.toUpperCase()}`;
        
        animatedBtn.addEventListener('click', cycleLanguage);
    } else {
        // This might still log if called before navigation is fully ready on slower systems,
        // or if there's a persistent issue with navigation rendering.
        console.warn("#animatedLangBtn not found during language switcher initialization.");
    }
}


// Initial language setup on DOMContentLoaded for static content.
// The main call to setLanguage for dynamically added content will happen in initializePage.
document.addEventListener('DOMContentLoaded', () => {
    const preferredLanguage = localStorage.getItem("preferredLanguage") || languages[0];
    // Ensure currentLanguageIndex is correctly set based on stored language
    const preferredLangIndex = languages.indexOf(preferredLanguage);
    if (preferredLangIndex !== -1) {
        currentLanguageIndex = preferredLangIndex;
    } else {
        currentLanguageIndex = 0; // Default to first language if stored one is invalid
    }
    setLanguage(languages[currentLanguageIndex]);
    // Note: initializeLanguageSwitcher() is NOT called here directly anymore.
    // It will be called by initializePage after navigation is built.
});
