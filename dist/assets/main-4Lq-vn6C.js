import{c as r,s as g,a as u,i as m,b as y,h as f,f as w,d,r as p}from"./common-sdwmEAW7.js";if("loading"in HTMLImageElement.prototype)document.querySelectorAll('img[loading="lazy"]').forEach(e=>{e.src=e.dataset.src});else{const t=document.createElement("script");t.src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js",document.body.appendChild(t)}class b{constructor(e,n){this.url=e,this.containerId=n,this.ws=null,this.reconnectDelay=5e3}connect(){try{this.ws=new WebSocket(this.url),this.setupEventHandlers()}catch(e){console.error("WebSocket connection error:",e),this.scheduleReconnect()}}setupEventHandlers(){this.ws.onopen=()=>{console.log("WebSocket connection established.")},this.ws.onmessage=e=>{this.handleMessage(e)},this.ws.onerror=e=>{console.error("WebSocket error:",e)},this.ws.onclose=()=>{console.log(`WebSocket connection closed. Code: ${event.code}, Reason: ${event.reason}`),this.scheduleReconnect()}}handleMessage(e){let n;try{n=JSON.parse(e.data)}catch{console.log("WebSocket received non-JSON message or malformed JSON:",e.data);return}typeof n=="object"&&n!==null&&(Object.prototype.hasOwnProperty.call(n,"killer_name")||Object.prototype.hasOwnProperty.call(n,"victim_name")||Object.prototype.hasOwnProperty.call(n,"time_stamp"))?this.addNewIncident(n):console.log("WebSocket received valid JSON, but not recognized as an incident:",n)}addNewIncident(e){const n=document.getElementById(this.containerId);if(n){const o=r(e);o?(n.insertBefore(o,n.firstChild),g(localStorage.getItem("preferredLanguage")||"en"),u()):console.warn("Websocket: Incident item did not result in a displayable card:",e)}else console.error(`WebSocket: Container with ID ${this.containerId} not found for new incident.`)}scheduleReconnect(){setTimeout(()=>{this.connect()},this.reconnectDelay)}disconnect(){this.ws&&(this.ws.onclose=null,this.ws.close(1e3,"Client initiated disconnect"),this.ws=null,console.log("WebSocket connection intentionally closed."))}}const a=20;let s=1,c=!1;async function h(t){y();try{await l(t);const e=document.getElementById("data-container");e&&e.scrollIntoView({behavior:"smooth",block:"start"})}catch(e){console.error("An unexpected error occurred:",e),document.getElementById("data-container").textContent="An error occurred while loading data."}finally{f()}}async function l(t){if(t<1){s=1,c=!1,d([],"data-container",r,{noDataMessage:"No recent incidents found."}),i();return}try{const e=(t-1)*a,n=await w(a+1,e);if(n.length===0&&t>1){await l(t-1);return}s=t,c=n.length>a;const o=n.slice(0,a);d(o,"data-container",r,{sortBy:"time_stamp",sortDirection:"desc",noDataMessage:"No recent incidents found."}),i()}catch(e){console.warn(`Failed to fetch page ${t}, trying page ${t-1}. Error:`,e),t>1?await l(t-1):(console.error("Error fetching initial incidents:",e),document.getElementById("data-container").textContent="Failed to load data.",s=1,c=!1,i())}}function i(){const t=document.getElementById("pagination-container");p({container:t,currentPage:s,hasNextPage:c,onPageClick:h})}document.addEventListener("DOMContentLoaded",async()=>{m("home"),await h(1),new b("wss://api.alpha-strike.space/ws/mails","data-container").connect()});
