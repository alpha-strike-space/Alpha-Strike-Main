(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function a(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=a(r);fetch(r.href,i)}})();function K(e){const t=document.getElementById("navigation-container");if(t){const n=window.location.pathname.endsWith("index.html")||window.location.pathname==="/"||window.location.pathname.endsWith("/Alpha-Strike-Main/")?"":"../";t.innerHTML=`
      <div class="topnav" id="myTopnav">
        <a href="${n}index.html" class="nav-logo alpha-strike-logo">
            Alpha-Strike
        </a>
        <button class="hamburger-menu" id="hamburgerBtn" aria-label="Toggle menu" aria-expanded="false" aria-controls="topnavLinks">
            <i class="fas fa-bars" aria-hidden="true"></i>
        </button>
        <div class="topnav-links" id="topnavLinks">
            <a ${e==="home"?'class="active"':""} href="${n}index.html"><i class="fa-sharp fa-solid fa-trophy"></i> <span data-translate="navbar.home">Recently Stamped</span></a>
            <a ${e==="killers"?'class="active"':""} href="${n}pages/killers.html"><i class="fa-solid fa-skull-crossbones"></i> <span data-translate="navbar.killers">Leading Killers</span></a>
            <a ${e==="victims"?'class="active"':""} href="${n}pages/victims.html"><i class="fa-solid fa-user-shield"></i> <span data-translate="navbar.victims">Leading Victims</span></a>
            <a ${e==="systems"?'class="active"':""} href="${n}pages/systems.html"><i class="fa-solid fa-map-location-dot"></i> <span data-translate="navbar.systems">Leading Systems</span></a>
            <div class="nav-search-container">
                <button id="navSearchToggle" class="nav-search-toggle" aria-label="Toggle search">
                    <i class="fa-solid fa-magnifying-glass"></i>
                </button>
                <div id="navSearchDropdown" class="nav-search-dropdown">
                    <div class="nav-search">
                        <select id="navSearchType">
                            <option value="name" data-translate="search.byName">Character</option>
                            <option value="system" data-translate="search.bySystem">System</option>
                        </select>
                        <input type="text" id="navSearchQuery" placeholder="Search..." data-translate="search.placeholder" />
                        <button id="navSearchBtn" aria-label="Search">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </button>
                    </div>
                </div>
            </div>
            <button id="animatedLangBtn" class="lang-btn-nav">EN</button>
        </div>
      </div>
    `;const r=document.getElementById("hamburgerBtn"),i=document.getElementById("topnavLinks"),s=document.getElementById("myTopnav"),o=r.querySelector("i");r&&i&&s&&o?r.addEventListener("click",()=>{i.classList.toggle("open"),s.classList.toggle("open");const c=i.classList.contains("open");r.setAttribute("aria-expanded",c.toString()),c?(o.classList.remove("fa-bars"),o.classList.add("fa-times")):(o.classList.remove("fa-times"),o.classList.add("fa-bars"))}):console.error("Hamburger menu elements not found. Navigation interactivity may be affected."),document.addEventListener("click",c=>{const f=document.querySelector(".nav-search-container"),u=document.getElementById("navSearchToggle"),p=document.getElementById("navSearchDropdown");f&&u&&p&&(f.contains(c.target)||p.classList.remove("show"))});const l=document.getElementById("navSearchToggle"),d=document.getElementById("navSearchDropdown");l&&d&&l.addEventListener("click",c=>{var f;c.stopPropagation(),d.classList.toggle("show"),d.classList.contains("show")&&((f=document.getElementById("navSearchQuery"))==null||f.focus())})}else console.error("Navigation container #navigation-container not found.")}let C={};const v=["en","es","ru","zh"];let b=0;function M(e,t){[...e.querySelectorAll("[data-translate]")].map(n=>{const r=n.getAttribute("data-translate"),i=C[r],s=i&&(i[t]||i.en)||r;if(s)if(n.tagName==="INPUT"&&n.placeholder!==void 0&&(r.includes(".placeholder")||r.endsWith("Placeholder")))n.placeholder=s;else if(n.tagName==="BUTTON"||n.classList.contains("timezone-toggle-floating")){const o=n.querySelector("i"),l=n.querySelector("span[data-translate]");l&&l.getAttribute("data-translate")===r?l.textContent=s:o?n.innerHTML=`${o.outerHTML} ${s}`:n.textContent=s}else{const o=n.firstChild;o&&o.nodeType===Node.ELEMENT_NODE&&o.tagName==="I"?n.innerHTML=`${o.outerHTML} ${s}`:n.textContent=s}})}function $(e){document.documentElement.lang=e,localStorage.setItem("preferredLanguage",e),M(document,e);const t=document.getElementById("animatedLangBtn");if(t){const r=t.querySelector("i.fa-globe"),i=r?`${r.outerHTML} `:"";t.innerHTML=`${i}${e.toUpperCase()}`}const a=v.indexOf(e);a!==-1&&(b=a);const n=new CustomEvent("languagechange",{detail:{lang:e}});document.dispatchEvent(n),window.AlphaStrike&&typeof window.AlphaStrike.onLanguageChangeRenderContent=="function"&&(console.log("Calling window.AlphaStrike.onLanguageChangeRenderContent() due to language change."),window.AlphaStrike.onLanguageChangeRenderContent())}function ne(){b=(b+1)%v.length;const e=v[b];$(e)}function V(){const e=document.getElementById("animatedLangBtn");if(e){const t=localStorage.getItem("preferredLanguage")||v[0],a=e.querySelector("i.fa-globe"),n=a?`${a.outerHTML} `:'<i class="fas fa-globe"></i> ';e.innerHTML=`${n}${t.toUpperCase()}`,e.addEventListener("click",ne)}else console.warn("#animatedLangBtn not found during language switcher initialization.")}async function re(){try{let e="";window.location.pathname.includes("/pages/")?e="../":(window.location.pathname.endsWith("/")||window.location.pathname.endsWith(".html"))&&(e="./");const t=await fetch(`${e}localization/translations.json`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status} for translations.json at ${e}localization/translations.json`);C=await t.json(),console.log("Translations loaded successfully.")}catch(e){console.error("Failed to load translations:",e),C={"error.loading":{en:"Error loading translations",es:"Error al cargar las traducciones",ru:"Ошибка загрузки переводов",zh:"加载翻译时出错"}}}}document.addEventListener("DOMContentLoaded",async()=>{await re();const e=localStorage.getItem("preferredLanguage")||v[0],t=v.indexOf(e);t!==-1?b=t:b=0,$(v[b])});class ie{constructor(){this.observer=null,this.init()}init(){"IntersectionObserver"in window&&(this.observer=new IntersectionObserver(t=>{t.forEach(a=>{if(a.isIntersecting){const n=a.target;n.dataset.src&&(n.src=n.dataset.src,n.removeAttribute("data-src")),this.observer.unobserve(n)}})},{rootMargin:"50px 0px",threshold:.01}))}addLazyLoading(t,a){this.observer?(t.dataset.src=a,t.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",this.observer.observe(t)):t.src=a}addLazyLoadingToImages(t){t.forEach(a=>{a.dataset.src&&this.addLazyLoading(a,a.dataset.src)})}testLazyLoading(){const t={intersectionObserverSupported:"IntersectionObserver"in window,observerInitialized:this.observer!==null,imagesObserved:0};if(this.observer){const a=document.querySelectorAll("img[data-src]");t.imagesObserved=a.length}return t.intersectionObserverSupported&&t.observerInitialized}}const Y=new ie;window.testLazyLoading=()=>Y.testLazyLoading();let N=!0;function Z(e,t=!0,a="en"){let n;if(typeof e=="string")n=new Date(e);else if(typeof e=="number")if(e<1e10)n=new Date(e*1e3);else if(e<1e13)n=new Date(e);else{const u=e/1e4-116444736e5;n=new Date(u)}if(!n||Number.isNaN(n.getTime())||n.getFullYear()>2100||n.getFullYear()<1970)return console.warn("Invalid timestamp:",e),"INVALID TIMESTAMP";if(t){const c=n.getFullYear(),f=String(n.getMonth()+1).padStart(2,"0"),u=String(n.getDate()).padStart(2,"0"),p=String(n.getHours()).padStart(2,"0"),h=String(n.getMinutes()).padStart(2,"0"),w=String(n.getSeconds()).padStart(2,"0"),y=n.toLocaleTimeString(a,{timeZoneName:"short"}).split(" ").pop();return`${c}.${f}.${u} - ${p}:${h}:${w} ${y}`}const r=n.getUTCFullYear(),i=String(n.getUTCMonth()+1).padStart(2,"0"),s=String(n.getUTCDate()).padStart(2,"0"),o=String(n.getUTCHours()).padStart(2,"0"),l=String(n.getUTCMinutes()).padStart(2,"0"),d=String(n.getUTCSeconds()).padStart(2,"0");return`${r}.${i}.${s} - ${o}:${l}:${d} UTC`}function se(){N=!N;const e=document.documentElement.lang||(typeof v<"u"?v[0]:"en");[...document.querySelectorAll(".timestamp-value")].map(r=>{const i=r.closest(".incident-list-item");i!=null&&i.dataset.timestamp&&(r.textContent=Z(typeof i.dataset.timestamp=="string"&&!Number.isNaN(i.dataset.timestamp)?Number(i.dataset.timestamp):i.dataset.timestamp,N))});const a=document.getElementById("timezone-toggle");if(a){const r=a.querySelector("span[data-translate]");if(r){const i=N?"timezone.showUtc":"timezone.showLocal";r.setAttribute("data-translate",i);const s=C[i],o=s?s[e]:void 0;o?r.textContent=o:(r.textContent=s?s.en:i,console.warn(`Translation not found for key: ${i}, lang: ${e}. Using fallback.`))}}[...document.querySelectorAll(".timestamp-group .detail-label")].map(r=>{const i=N?"card.localTimeLabel":"card.utcTimeLabel";if(r.setAttribute("data-translate",i),typeof C<"u"&&C[i]&&C[i][e])r.textContent=C[i][e];else{let s=i.replace("card.","").replace("Label","");s=`${s.charAt(0).toUpperCase()+s.slice(1)} TIME:`,r.textContent=s,console.warn(`Translation not found for key: ${i}, lang: ${e}. Using fallback.`)}}),window.AlphaStrike&&typeof window.AlphaStrike.onLanguageChangeRenderContent=="function"&&(console.log("ToggleTimezone: Calling page-specific render function."),window.AlphaStrike.onLanguageChangeRenderContent())}async function I(e){try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);return await t.json()}catch(t){throw console.error("Error fetching data:",t),t}}const oe="https://world-api-stillness.live.tech.evefrontier.com";async function R(e){if(!e)return Promise.resolve(null);const t=`${oe}/v2/smartcharacters/${e}`;try{const a=await I(t);return a||null}catch(a){return console.error(`Error fetching smart character by address ${e}:`,a),null}}async function q(e){const t=R(e.killer_address),a=R(e.victim_address),[n,r]=await Promise.all([t,a]);return{...e,killer_id:n?n.id:null,victim_id:r?r.id:null,killer_portrait_url:n?n.portraitUrl:null,victim_portrait_url:r?r.portraitUrl:null}}async function Te(e=20,t=0){const a=await I(`https://api.alpha-strike.space/incident?filter=month&limit=${e}&offset=${t}`);return!a||!Array.isArray(a)?[]:a}async function $e(e){const t=await I(`https://api.alpha-strike.space/incident?mail_id=${e}`);if(!t||t.length===0)return null;const a=t[0];return[await q(a)]}async function O(e,t,a,n){let r=t==="system"?`https://api.alpha-strike.space/incident?system=${encodeURIComponent(e)}`:`https://api.alpha-strike.space/incident?name=${encodeURIComponent(e)}`;a!==void 0&&n!==void 0&&(r+=`&limit=${a}&offset=${n}`);const i=await I(r);return!i||!Array.isArray(i)?[]:i}async function Ie(e="month"){return await I(`https://api.alpha-strike.space/totals?filter=${e}`)}async function ke(e="week"){return await I(`https://api.alpha-strike.space/totals?filter=${e}`)}async function Ne(e="day"){return await I(`https://api.alpha-strike.space/totals?filter=${e}`)}async function ce(e,t){const a=t==="system"?`https://api.alpha-strike.space/totals?system=${encodeURIComponent(e)}`:`https://api.alpha-strike.space/totals?name=${encodeURIComponent(e)}`;return await I(a)}function Q(e){let t;if(typeof e=="string")t=new Date(e);else if(typeof e=="number")if(e<1e10)t=new Date(e*1e3);else if(e<1e13)t=new Date(e);else{const f=e/1e4-116444736e5;t=new Date(f)}if(!t||Number.isNaN(t.getTime())||t.getFullYear()>2100||t.getFullYear()<1970)return"";const n=new Date-t;if(n<0)return"";const r=Math.floor(n/(1e3*60*60*24)),i=Math.floor(n%(1e3*60*60*24)/(1e3*60*60)),s=Math.floor(n%(1e3*60*60)/(1e3*60)),o=localStorage.getItem("preferredLanguage")||"en",l=(d,c={})=>{var u,p;let f=((u=C[d])==null?void 0:u[o])||((p=C[d])==null?void 0:p.en)||d;for(const h in c)f=f.replace(new RegExp(`\\{${h}\\}`,"g"),c[h]);return f};return r>0?l("time.daysHoursAgo",{days:r,hours:i}):i>0?l("time.hoursMinutesAgo",{hours:i,minutes:s}):s>0?l("time.minutesAgo",{minutes:s}):l("time.justNow")}function le(){document.querySelectorAll(".time-elapsed").forEach(t=>{const a=t.closest(".incident-list-item");if(a!=null&&a.dataset.timestamp){const n=typeof a.dataset.timestamp=="string"&&!Number.isNaN(Number(a.dataset.timestamp))?Number(a.dataset.timestamp):a.dataset.timestamp;t.textContent=Q(n)}})}document.addEventListener("languagechange",()=>{le()});function G(e){if(!e||typeof e!="object")return console.warn("Invalid item passed to createIncidentCard:",e),null;if(e.id===void 0||e.id===null)return console.warn("Skipping card creation for item missing 'id':",e),null;if(!e.killer_name&&!e.victim_name&&!e.loss_type&&!e.solar_system_name&&!e.time_stamp)return console.warn("Skipping card creation for effectively empty item:",e),null;const a=document.createElement("div");a.className="incident-list-item",a.dataset.timestamp=e.time_stamp;const n=window.location.pathname.endsWith("index.html")||window.location.pathname==="/"||window.location.pathname.endsWith("/Alpha-Strike-Main/"),r=n?"./":"../",i=n?"pages/":"",s=e.time_stamp?Z(e.time_stamp,N,localStorage.getItem("preferredLanguage")||"en"):"N/A",o=e.time_stamp?Q(e.time_stamp):"",l=N?"card.localTimeLabel":"card.utcTimeLabel",d=j(e.killer_portrait_url,r),c=j(e.victim_portrait_url,r),f=localStorage.getItem("preferredLanguage")||"en";function u(g,L={},m=""){var A,U;let S=m;typeof C<"u"&&((A=C[g])!=null&&A[f])?S=C[g][f]:typeof C<"u"&&((U=C[g])!=null&&U.en)&&(S=C[g].en);for(const B in L)S=S.replace(`{${B}}`,L[B]);return S}const p=e.killer_name||"UNKNOWN",h=e.victim_name||"UNKNOWN",w=e.solar_system_name||"UNKNOWN";let y="";const x=e.id,E=u("tooltip.viewKillmailDetails",{killmailId:x},`View details for killmail ${x}`);return y=`
      <div class="incident-detail-link-container">
          <a href="${i}killmail.html?mail_id=${encodeURIComponent(x)}"
             class="view-killmail-details-link icon-only-link"
             aria-label="${E}"
             title="${E}">
             <i class="fa-sharp fa-solid fa-arrow-up-right-from-square"></i>
          </a>
      </div>
  `,a.innerHTML=`
        <div class="incident-photos">
            <div class="photo-container killer-photo">
                <img src="${d}" alt="Aggressor" class="combatant-photo killer-image"/>
            </div>
            <div class="vs-indicator"><i class="fas fa-bolt"></i></div>
            <div class="photo-container victim-photo">
                <img src="${c}" alt="Victim" class="combatant-photo victim-image"/>
            </div>
        </div>
        <div class="incident-combatants">
            <div class="combatant-info killer-info">
                <span class="combatant-label" data-translate="card.aggressor"></span>
                <span class="combatant-name killer clickable-name" data-name="${p}" title="${u("tooltip.searchFor",{itemName:p},`Search for ${p}`)}">${p}<i class="fa-sharp fa-solid fa-arrow-up-right-from-square"></i></span>
            </div>
            <div class="combatant-info victim-info">
                <span class="combatant-label" data-translate="card.casualty"></span>
                <span class="combatant-name victim clickable-name" data-name="${h}" title="${u("tooltip.searchFor",{itemName:h},`Search for ${h}`)}">${h}<i class="fa-sharp fa-solid fa-arrow-up-right-from-square"></i></span>
            </div>
        </div>
        <div class="incident-details-compact">
            <div class="detail-group">
                <span class="detail-label" data-translate="card.lossType"></span>
                <span class="detail-value">${e.loss_type||"CLASSIFIED"}</span>
            </div>
            <div class="detail-group">
                <span class="detail-label" data-translate="card.location"></span>
                <span class="detail-value clickable-system" data-system="${w}" title="${u("tooltip.searchFor",{itemName:w},`Search for ${w}`)}">${w}<i class="fa-sharp fa-solid fa-arrow-up-right-from-square"></i></span>
            </div>
        </div>
        <div class="incident-timestamp">
            <div class="timestamp-group">
                <span class="detail-label timestamp-label" data-translate="${l}"></span>
                <span class="timestamp-value">${s}</span>
                ${o?`<span class="time-elapsed">${o}</span>`:""}
            </div>
        </div>
        ${y}
    `,a}function W(e,t){if(!e||e==="UNKNOWN"||e==="CLASSIFIED"){console.warn("Cannot search for empty, unknown, or classified values");return}const r=`${window.location.pathname.endsWith("index.html")||window.location.pathname==="/"||window.location.pathname.endsWith("/Alpha-Strike-Main/")?"pages/search.html":window.location.pathname.includes("/pages/")?"search.html":"../pages/search.html"}?query=${encodeURIComponent(e)}&type=${t}`;window.location.href=r}function z(e){const t=e||document;for(const a of t.querySelectorAll(".clickable-name"))a.dataset.listenerAttached||(a.addEventListener("click",n=>{n.preventDefault();const r=a.dataset.name;r&&r!=="UNKNOWN"&&W(r,"name")}),a.dataset.listenerAttached="true");for(const a of t.querySelectorAll(".clickable-system"))a.dataset.listenerAttached||(a.addEventListener("click",n=>{n.preventDefault();const r=a.dataset.system;r&&r!=="UNKNOWN"&&W(r,"system")}),a.dataset.listenerAttached="true")}const J=(e,t="")=>{var n,r;const a=v[b];return((n=C[e])==null?void 0:n[a])||((r=C[e])==null?void 0:r.en)||t};function de(e){const t=Math.min(1,Math.max(0,Number(e)||0)),a=[{p:0,r:210,g:36,b:36},{p:.67,r:207,g:199,b:54},{p:.9,r:45,g:200,b:110},{p:1,r:45,g:165,b:195}];if(t<=a[0].p){const{r:s,g:o,b:l}=a[0];return`rgb(${s}, ${o}, ${l})`}for(let s=1;s<a.length;s++){const o=a[s-1],l=a[s];if(t<=l.p){const d=(t-o.p)/(l.p-o.p),c=Math.round(o.r+d*(l.r-o.r)),f=Math.round(o.g+d*(l.g-o.g)),u=Math.round(o.b+d*(l.b-o.b));return`rgb(${c}, ${f}, ${u})`}}const{r:n,g:r,b:i}=a[a.length-1];return`rgb(${n}, ${r}, ${i})`}function he(e){const t=Math.min(1,Math.max(0,Number(e)||0));return t<=.1?"stoic":t<=.25?"probing":t<=.33?"prowling":t<=.42?"stalking":t<=.5?"menacing":t<=.67?"predatory":t<=.9?"ruthless":"lethal"}function ue(e){const t=e.total_losses>0?(e.total_kills/e.total_losses).toFixed(2):e.total_kills||0,a=(e.total_kills||0)+(e.total_losses||0),n=a>0?((e.total_kills||0)/a*100).toFixed(1):0;return{killDeathRatio:t,totalEngagements:a,winRate:n}}function fe(e,t,a){const n=document.createElement("div");n.className="card-header";const r=document.createElement("div");r.className="profile-section";const i=document.createElement("div");i.className="profile-image-container";const s=document.createElement("img");s.className="profile-image",s.alt=`${e.name}'s profile`;const l=window.location.pathname.endsWith("index.html")||window.location.pathname==="/"||window.location.pathname.endsWith("/Alpha-Strike-Main/")?"./":"../";s.src=j(a,l),i.appendChild(s);const d=document.createElement("div");d.className="profile-info";const c=document.createElement("h2");c.className="player-name",c.textContent=e.name;const f=document.createElement("p");f.className="player-status",f.textContent=e.status||J("general.unknown"),d.appendChild(c),d.appendChild(f),r.appendChild(i),r.appendChild(d);const u=document.createElement("div");u.className="header-stats";const p=document.createElement("div");p.className="header-stat",p.innerHTML=`
        <div class="header-stat-value ${t.killDeathRatio>1?"killer":"victim"}">${t.killDeathRatio}</div>
        <div class="header-stat-label" data-translate="card.kdRatio">K/D Ratio</div>
    `;const h=document.createElement("div");h.className="header-stat",h.innerHTML=`
        <div class="header-stat-value">${t.winRate}%</div>
        <div class="header-stat-label" data-translate="card.winRate">Win Rate</div>
    `;const w=Math.min(1,Math.max(0,(parseFloat(t.winRate)||0)/100)),y=de(w),x=h.querySelector(".header-stat-value");x&&(x.style.color=y);const k=document.createElement("div");k.className="header-stat-descriptor",k.textContent=he(w).toUpperCase();const E=h.querySelector(".header-stat-label");E?h.insertBefore(k,E):h.appendChild(k);const g=document.createElement("div");return g.className="header-stat",g.innerHTML=`
        <div class="header-stat-value">${t.totalEngagements}</div>
        <div class="header-stat-label" data-translate="card.totalEngagements">Total Engagements</div>
    `,u.appendChild(p),u.appendChild(h),u.appendChild(g),n.appendChild(r),n.appendChild(u),n}function pe(e){const t=e.incident_count&&e.days_active?(e.incident_count/e.days_active).toFixed(1):"< 1",a=e.incident_count>100?"HIGH":e.incident_count>50?"MEDIUM":"LOW";return{avgIncidentsPerDay:t,threatLevel:a,threatClass:a==="HIGH"?"threat-high":a==="MEDIUM"?"threat-medium":"threat-low",totalIncidents:e.incident_count||0,activeDays:e.days_active||0}}function me(e,t){const a=document.createElement("div");a.className="card-header";const n=document.createElement("div");n.className="system-section";const r=document.createElement("div");r.className="system-image-container";const i=document.createElement("i");i.className="fa-solid fa-sun system-image",i.setAttribute("aria-label","system star"),r.appendChild(i);const s=document.createElement("div");s.className="system-info";const o=document.createElement("h2");o.className="system-name",o.textContent=e.solar_system_name||e.name;const l=document.createElement("p");l.className="system-region",l.textContent=e.region_name||e.region||J("general.unknown"),s.appendChild(o),s.appendChild(l),n.appendChild(r),n.appendChild(s);const d=document.createElement("div");d.className="header-stats";const c=document.createElement("div");c.className="header-stat",c.innerHTML=`
        <div class="header-stat-value ${t.threatClass}">${t.totalIncidents}</div>
        <div class="header-stat-label" data-translate="card.incidentCount">Incidents</div>
    `;const f=document.createElement("div");f.className="header-stat",f.innerHTML=`
        <div class="header-stat-value">${t.avgIncidentsPerDay}</div>
        <div class="header-stat-label" data-translate="card.avgPerDay">Per Day</div>
    `;const u=document.createElement("div");return u.className="header-stat",u.innerHTML=`
        <div class="header-stat-value">${t.activeDays}</div>
        <div class="header-stat-label" data-translate="card.activeDays">Active Days</div>
    `,d.appendChild(c),d.appendChild(f),d.appendChild(u),a.appendChild(n),a.appendChild(d),a}async function ge(e){const t=document.createElement("div");t.className="data-card enhanced-player-card",t.dataset.id=e.id;let a=e.portraitUrl||null;if(!a&&e.character_address)try{const i=await R(e.character_address);i&&(a=i.portraitUrl)}catch(i){console.warn(`Could not fetch character by address for card: ${e.character_address}`,i)}const n=ue(e),r=fe(e,n,a);return t.appendChild(r),t}function ye(e){const t=document.createElement("div");t.className="data-card enhanced-system-card",t.dataset.id=e.id;const a=pe(e),n=me(e,a);t.appendChild(n);const r=t.querySelector(".system-image");return r&&Y.addLazyLoading(r,"https://images.evetech.net/types/3796/render"),t}async function ve(e,t){const a=document.getElementById("totals-card");if(a.innerHTML="",!e||e.length===0){a.innerHTML='<p data-translate="search.noAggregatedData">No aggregated data found.</p>';return}const n=e[0],r=t==="system"?ye(n):await ge(n);a.appendChild(r)}function X(e,t="loading.data"){if(!e)return;const a=document.createElement("div");a.className="inline-loader-wrapper";const n=`
<svg class="inline-loader-svg" xmlns="http://www.w3.org/2000/svg" width="38" height="43" viewBox="0 0 38 43" fill="none">
<rect x="20.5" y="0.5" width="2" height="2" fill="currentColor"></rect><rect x="25.5" y="0.5" width="2" height="2" fill="currentColor"></rect><rect x="30.5" y="0.5" width="2" height="2" fill="currentColor"></rect><rect x="35.5" y="0.5" width="2" height="2" fill="currentColor"></rect><rect x="20.5" y="5.5" width="2" height="2" fill="currentColor"></rect><rect x="25.5" y="5.5" width="2" height="2" fill="currentColor"></rect><rect x="30.5" y="5.5" width="2" height="2" fill="currentColor"></rect><rect x="35.5" y="5.5" width="2" height="2" fill="currentColor"></rect><rect x="20.5" y="10.5" width="2" height="2" fill="currentColor"></rect><rect x="25.5" y="10.5" width="2" height="2" fill="currentColor"></rect><rect x="30.5" y="10.5" width="2" height="2" fill="currentColor"></rect><rect x="35.5" y="10.5" width="2" height="2" fill="currentColor"></rect><rect x="20.5" y="30.5" width="2" height="2" fill="currentColor"></rect><rect x="25.5" y="30.5" width="2" height="2" fill="currentColor"></rect><rect x="30.5" y="30.5" width="2" height="2" fill="currentColor"></rect><rect x="35.5" y="30.5" width="2" height="2" fill="currentColor"></rect><rect x="20.5" y="35.5" width="2" height="2" fill="currentColor"></rect><rect x="25.5" y="35.5" width="2" height="2" fill="currentColor"></rect><rect x="30.5" y="35.5" width="2" height="2" fill="currentColor"></rect><rect x="35.5" y="35.5" width="2" height="2" fill="currentColor"></rect><rect x="20.5" y="40.5" width="2" height="2" fill="currentColor"></rect><rect x="25.5" y="40.5" width="2" height="2" fill="currentColor"></rect><rect x="30.5" y="40.5" width="2" height="2" fill="currentColor"></rect><rect x="35.5" y="40.5" width="2" height="2" fill="currentColor"></rect><rect x="20.5" y="15.5" width="2" height="2" fill="currentColor"></rect><rect x="25.5" y="15.5" width="2" height="2" fill="currentColor"></rect><rect x="30.5" y="15.5" width="2" height="2" fill="currentColor"></rect><rect x="35.5" y="15.5" width="2" height="2" fill="currentColor"></rect><rect x="20.5" y="20.5" width="2" height="2" fill="currentColor"></rect><rect x="25.5" y="20.5" width="2" height="2" fill="currentColor"></rect><rect x="30.5" y="20.5" width="2" height="2" fill="currentColor"></rect><rect x="35.5" y="20.5" width="2" height="2" fill="currentColor"></rect><rect x="20.5" y="25.5" width="2" height="2" fill="currentColor"></rect><rect x="25.5" y="25.5" width="2" height="2" fill="currentColor"></rect><rect x="30.5" y="25.5" width="2" height="2" fill="currentColor"></rect><rect x="35.5" y="25.5" width="2" height="2" fill="currentColor"></rect><rect x="0.5" y="0.5" width="2" height="2" fill="currentColor"></rect><rect x="5.5" y="0.5" width="2" height="2" fill="currentColor"></rect><rect x="10.5" y="0.5" width="2" height="2" fill="currentColor"></rect><rect x="15.5" y="0.5" width="2" height="2" fill="currentColor"></rect><rect x="0.5" y="5.5" width="2" height="2" fill="currentColor"></rect><rect x="5.5" y="5.5" width="2" height="2" fill="currentColor"></rect><rect x="10.5" y="5.5" width="2" height="2" fill="currentColor"></rect><rect x="15.5" y="5.5" width="2" height="2" fill="currentColor"></rect><rect x="0.5" y="10.5" width="2" height="2" fill="currentColor"></rect><rect x="5.5" y="10.5" width="2" height="2" fill="currentColor"></rect><rect x="10.5" y="10.5" width="2" height="2" fill="currentColor"></rect><rect x="15.5" y="10.5" width="2" height="2" fill="currentColor"></rect><rect x="0.5" y="30.5" width="2" height="2" fill="currentColor"></rect><rect x="5.5" y="30.5" width="2" height="2" fill="currentColor"></rect><rect x="10.5" y="30.5" width="2" height="2" fill="currentColor"></rect><rect x="15.5" y="30.5" width="2" height="2" fill="currentColor"></rect><rect x="0.5" y="35.5" width="2" height="2" fill="currentColor"></rect><rect x="5.5" y="35.5" width="2" height="2" fill="currentColor"></rect><rect x="10.5" y="35.5" width="2" height="2" fill="currentColor"></rect><rect x="15.5" y="35.5" width="2" height="2" fill="currentColor"></rect><rect x="0.5" y="40.5" width="2" height="2" fill="currentColor"></rect><rect x="5.5" y="40.5" width="2" height="2" fill="currentColor"></rect><rect x="10.5" y="40.5" width="2" height="2" fill="currentColor"></rect><rect x="15.5" y="40.5" width="2" height="2" fill="currentColor"></rect><rect x="0.5" y="15.5" width="2" height="2" fill="currentColor"></rect><rect x="5.5" y="15.5" width="2" height="2" fill="currentColor"></rect><rect x="10.5" y="15.5" width="2" height="2" fill="currentColor"></rect><rect x="15.5" y="15.5" width="2" height="2" fill="currentColor"></rect><rect x="0.5" y="20.5" width="2" height="2" fill="currentColor"></rect><rect x="5.5" y="20.5" width="2" height="2" fill="currentColor"></rect><rect x="10.5" y="20.5" width="2" height="2" fill="currentColor"></rect><rect x="15.5" y="20.5" width="2" height="2" fill="currentColor"></rect><rect x="0.5" y="25.5" width="2" height="2" fill="currentColor"></rect><rect x="5.5" y="25.5" width="2" height="2" fill="currentColor"></rect><rect x="10.5" y="25.5" width="2" height="2" fill="currentColor"></rect><rect x="15.5" y="25.5" width="2" height="2" fill="currentColor"></rect>
</svg>`.trim(),r=Array(10).fill(n).join("");a.innerHTML=`
    <div class="inline-loader">
        <div class="inline-loader-svg-container">
            ${r}
        </div>
      <span class="inline-loader-text" data-translate="${t}"></span>
    </div>
  `,M(a,v[b]),e.innerHTML="",e.appendChild(a)}function ee(e){if(e){const t=e.querySelector(".inline-loader-wrapper");t&&t.remove()}}function we({container:e,currentPage:t,hasNextPage:a,onPageClick:n,totalPages:r=null}){if(!e)return;e.innerHTML="";const i=(c,f,u=!1,p=!1)=>{const h=document.createElement("button");return h.textContent=c,h.disabled=u,p&&h.classList.add("active"),h.addEventListener("click",()=>n(f)),h},s=r!==null?t<r:a;e.appendChild(i("«",t-1,t===1));const o=2;let l=Math.max(1,t-o),d;if(r?d=Math.min(r,t+o):d=t+o,l>1&&(e.appendChild(i("1",1)),l>2)){const c=document.createElement("span");c.textContent="...",e.appendChild(c)}for(let c=l;c<=d;c++)!r&&c>t&&!a||e.appendChild(i(c.toString(),c,!1,c===t));if(r&&d<r){if(d<r-1){const c=document.createElement("span");c.textContent="...",e.appendChild(c)}e.appendChild(i(r.toString(),r))}else if(!r&&a){const c=document.createElement("span");c.textContent="...",e.appendChild(c)}e.appendChild(i("»",t+1,!s))}const T=20;let D=1,_=!1,te="",ae="",P=0;function Ce(){const e=new URLSearchParams(window.location.search);return{query:e.get("query"),type:e.get("type")}}function Le(){const e=document.getElementById("navSearchBtn"),t=document.getElementById("navSearchQuery"),a=document.getElementById("navSearchType");!e||!t||!a||(e.addEventListener("click",()=>{const n=t.value.trim();if(n===""){alert("Please enter a search query.");return}W(n,a.value)}),t.addEventListener("keypress",n=>{n.key==="Enter"&&e.click()}))}function be(e,t){if(!e||!e.trim())return[];if(e=e.trim(),t==="system")return[e.toUpperCase()];const a=e.toLowerCase(),n=e.toUpperCase(),r=e.charAt(0).toUpperCase()+e.slice(1).toLowerCase();return[...new Set([e,a,n,r])]}function H(){const e=document.getElementById("pagination-container");e&&(D>1||_?(e.style.display="flex",we({container:e,currentPage:D,hasNextPage:_,onPageClick:Se,totalPages:P>0?Math.ceil(P/T):null})):e.style.display="none")}async function Se(e){const t=document.getElementById("results-container");X(t,"Loading Incidents...");try{await F(e),t&&t.scrollIntoView({behavior:"smooth",block:"start"})}catch(a){console.error("Error fetching search page:",a),t.innerHTML='<p data-translate="search.error">Error loading search results.</p>'}finally{ee(t);const a=localStorage.getItem("preferredLanguage")||"en";$(a)}}async function F(e){if(e<1){D=1,_=!1;const a=document.getElementById("results-container");a.innerHTML='<p data-translate="search.noResults">No search results found.</p>',M(a,v[b]),H();return}const t=document.getElementById("results-container");try{const a=(e-1)*T,n=await O(te,ae,T+1,a);if(n.length===0&&e>1){await F(e-1);return}t.innerHTML="",D=e,_=n.length>T;const r=n.slice(0,T);if(r.length===0)t.innerHTML='<p data-translate="search.noResults">No search results found.</p>',M(t,v[b]);else{const i=r.map(async s=>{const o=await q(s),l=G(o);l&&(t.appendChild(l),z(l),M(l,v[b]))});await Promise.all(i)}H()}catch(a){console.warn(`Failed to fetch search page ${e}, trying page ${e-1}. Error:`,a),e>1?await F(e-1):(console.error("Error fetching initial search results:",a),t.innerHTML='<p data-translate="search.error">Error loading search results.</p>',D=1,_=!1,H())}}async function xe(e,t){var c,f;const a=document.getElementById("results-container"),n=document.getElementById("totals-card"),r=document.getElementById("pagination-container");if(!a||!n||!r)return;D=1,P=0,X(a,"Searching..."),n.innerHTML="",r.style.display="none";const i=be(e,t);let s=null,o=[],l=[];for(const u of i)try{const[p,h]=await Promise.all([ce(u,t),O(u,t,T+1,0)]);if((h==null?void 0:h.length)>0){s=u,o=h,l=p||[];break}}catch{}if(ee(a),s){if(te=s,ae=t,l&&l.length>0){const p=l[0];if(t==="system"){P=p.incident_count||0;try{const h=new Set,w=g=>{let L;if(typeof g=="string"){let m=g.trim();/\bUTC\b/i.test(m)?(m=m.replace(/\s+UTC/i,""),m=m.replace(" ","T"),m=m.endsWith("Z")?m:m+"Z",L=new Date(m)):/[zZ]|[+\-]\d{2}:?\d{2}$/.test(m)?L=new Date(m):/^\d{4}-\d{2}-\d{2}(?:[ T]\d{2}:\d{2}:\d{2})?$/.test(m)?(m=m.replace(" ","T"),L=new Date(m+"Z")):L=new Date(m)}else if(typeof g=="number")if(g<1e10)L=new Date(g*1e3);else if(g<1e13)L=new Date(g);else{const A=g/1e4-116444736e5;L=new Date(A)}return L},y=500;let x=0;const k=200;let E=0;for(;E<k;){const g=await O(s,t,y,x);if(!Array.isArray(g)||g.length===0)break;for(const L of g){const m=L==null?void 0:L.time_stamp;if(m==null)continue;const S=w(m);if(!S||Number.isNaN(S.getTime()))continue;const A=S.getUTCFullYear(),U=String(S.getUTCMonth()+1).padStart(2,"0"),B=String(S.getUTCDate()).padStart(2,"0");h.add(`${A}-${U}-${B}`)}if(x+=g.length,g.length<y)break;E+=1}h.size>0&&(p.days_active=h.size)}catch{}}else if(P=(p.total_kills||0)+(p.total_losses||0),t==="name"&&(o==null?void 0:o.length)>0){const h=o[0];let w=null;if(((c=h.killer_name)==null?void 0:c.toLowerCase())===s.toLowerCase()?w=h.killer_address:((f=h.victim_name)==null?void 0:f.toLowerCase())===s.toLowerCase()&&(w=h.victim_address),w)try{const y=await R(w);y!=null&&y.portraitUrl&&(p.portraitUrl=y.portraitUrl)}catch(y){console.warn(`Could not fetch portrait for ${w}`,y)}}}await ve(l,t),a.innerHTML="",_=o.length>T;const u=o.slice(0,T);if(u.length>0){const p=u.map(async h=>{const w=await q(h),y=G(w);y&&(a.appendChild(y),z(y),M(y,v[b]))});await Promise.all(p)}H()}else a.innerHTML='<p data-translate="search.noResults">No results found for your query.</p>';const d=localStorage.getItem("preferredLanguage")||"en";$(d)}function Ae(){const{query:e,type:t}=Ce();e&&xe(decodeURIComponent(e),t||"name")}const Ee={"https://artifacts.evefrontier.com/portraits/PortraitAwakened256.png":"assets/images/portraits/PortraitAwakened256.avif","https://artifacts.evefrontier.com/portraits/PortraitAscended256.png":"assets/images/portraits/PortraitAscended256.avif","https://artifacts.evefrontier.com/portraits/PortraitRainmakers256.png":"assets/images/portraits/PortraitRainmakers256.avif","https://artifacts.evefrontier.com/portraits/PortraitInitiated256.png":"assets/images/portraits/PortraitInitiated256.avif","https://artifacts.evefrontier.com/Character/123456789_256.jpg":"assets/images/portraits/123456789_256.avif","https://artifacts.evefrontier.com/portraits/PortraitSeers256.png":"assets/images/portraits/PortraitSeers256.avif","https://artifacts.evefrontier.com/portraits/PortraitHarbingers256.png":"assets/images/portraits/PortraitHarbingers256.avif"};function j(e,t){const a=`${t}assets/images/default-avatar.avif`;if(!e)return console.warn("Missing portrait URL. Using default avatar. Please download the image and update the portraitUrlMapping in js/common.js.",e),a;const n=Ee[e];return n?t+n:(console.warn(`Missing local mapping for portrait URL: "${e}". Using default avatar. Please download the image and update the portraitUrlMapping in js/common.js.`),a)}function Me(e){if(typeof K=="function")K(e);else{console.error("initializeNavigation function is not defined. Ensure components/navigation.js is loaded.");return}typeof V=="function"?V():console.error("initializeLanguageSwitcher function not found. Ensure translation-dictionary.js is loaded correctly and defines it.");const t=document.getElementById("timezone-toggle");if(t&&(t.hasAttribute("data-listener-attached")||(t.addEventListener("click",se),t.setAttribute("data-listener-attached","true"))),typeof $=="function"&&typeof v<"u"&&v.length>0){const a=localStorage.getItem("preferredLanguage")||v[0];$(a)}else console.error("setLanguage function or languages array not found. Translation system might not be fully initialized.");Le()}function De(e,t,a,n={}){const r=document.getElementById(t);if(!r){console.error(`Container with ID ${t} not found`);return}if(r.innerHTML="",!e||e.length===0){r.textContent=n.noDataMessage||"No data available.";return}n.sortBy&&n.sortDirection&&e.sort((s,o)=>{const l=s&&typeof s=="object"&&Object.prototype.hasOwnProperty.call(s,n.sortBy)?s[n.sortBy]:void 0,d=o&&typeof o=="object"&&Object.prototype.hasOwnProperty.call(o,n.sortBy)?o[n.sortBy]:void 0;if(l==null)return n.sortDirection==="desc"?1:-1;if(d==null)return n.sortDirection==="desc"?-1:1;let c=0;return l>d?c=1:l<d&&(c=-1),n.sortDirection==="desc"?c*-1:c});let i=e;if(n.limit&&(i=e.slice(0,n.limit)),[...i].map(s=>{const o=a(s);o?r.appendChild(o):console.warn("Skipping invalid card for item:",s)}),typeof z=="function"&&z(),typeof $=="function"&&typeof v<"u"&&v.length>0){const s=localStorage.getItem("preferredLanguage")||v[0];$(s)}}export{z as a,X as b,G as c,De as d,q as e,Te as f,M as g,b as h,Me as i,re as j,$e as k,v as l,j as m,Z as n,N as o,Ae as p,Ne as q,we as r,$ as s,C as t,ke as u,Ie as v,W as w};
