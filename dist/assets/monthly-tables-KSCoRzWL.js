import{t as s,j as L,m as $,v as T,w as b,x as S,s as v,y as u}from"./common-MNa96gSX.js";function I(e){var a,i;const l=document.getElementById("rollingAverageHeader");if(l&&e){let r=`Rolling ${e.charAt(0).toUpperCase()+e.slice(1)} Average`;const d=`header.rolling${e.charAt(0).toUpperCase()+e.slice(1)}`,y=localStorage.getItem("preferredLanguage")||"en";typeof s<"u"&&((a=s[d])!=null&&a[y])?r=s[d][y]:typeof s<"u"&&((i=s[d])!=null&&i.en)&&(r=s[d].en),l.textContent=r}else l||console.warn("updateRollingAverageHeaderText: rollingAverageHeader element not found."),e||console.warn("updateRollingAverageHeaderText: timeRange parameter is missing.")}async function D(e,l,a="month"){var n,g,p;const i="totals_",r={day:3e5,week:18e5,month:36e5},d=`${i}${a}_${e}`,y=r[a]||r.month,f=document.getElementById("data-container"),c=document.getElementById(l),m=c?c.querySelector("tbody"):null;if(!c||!m){console.error(`Table or table body not found for ID: ${l}.`),f&&(f.textContent="Error: UI elements missing.");return}if(c&&(c.style.display="none"),f){const t=localStorage.getItem("preferredLanguage")||"en",o=((n=s["loading.data"])==null?void 0:n[t])||"Loading data...";f.innerHTML=`<p data-translate="loading.data">${o}</p>`}L();try{const t=localStorage.getItem(d);if(t){const{timestamp:o,data:h}=JSON.parse(t);if(Date.now()-o<y){console.log(`Using cached data for metric: ${e}, timeRange: ${a}`);const N=h[e];k(N,c,m,e,f,a),$();return}console.log(`Cache expired for metric: ${e}, timeRange: ${a}`),localStorage.removeItem(d)}}catch(t){console.error("Error reading from localStorage:",t),$()}try{let t;if(a==="day"?t=await T():a==="week"?t=await b():t=await S(),!t||typeof t!="object"||!t[e]){console.error(`No data returned or invalid structure for metric: ${e} in API response:`,t);const h=localStorage.getItem("preferredLanguage")||"en",N=((g=s["error.noData"])==null?void 0:g[h])||`No data available for metric: ${e}`;f&&(f.innerHTML=`<p data-translate="error.noData">${N}</p>`),c&&(c.style.display="none"),$();return}try{localStorage.setItem(d,JSON.stringify({timestamp:Date.now(),data:t}))}catch(h){console.error("Error saving to localStorage:",h)}const o=t[e];k(o,c,m,e,f,a)}catch(t){console.error(`Error fetching data for metric: ${e}`,t);const o=localStorage.getItem("preferredLanguage")||"en",h=((p=s["error.loadFailed"])==null?void 0:p[o])||"Failed to load data.";f&&(f.innerHTML=`<p data-translate="error.loadFailed">${h}</p>`),c&&(c.style.display="none")}$()}function k(e,l,a,i,r,d){var f,c,m;const y=document.getElementById("rollingAverageHeader");if(y){let n=`Rolling ${d.charAt(0).toUpperCase()+d.slice(1)} Average`;const g=`header.rolling${d.charAt(0).toUpperCase()+d.slice(1)}`,p=localStorage.getItem("preferredLanguage")||"en";typeof s<"u"&&((f=s[g])!=null&&f[p])?n=s[g][p]:typeof s<"u"&&((c=s[g])!=null&&c.en)&&(n=s[g].en),y.textContent=n}r&&(r.textContent=""),l.style.display="table",a.innerHTML="",e&&Array.isArray(e)&&e.length>0?[...e].map(n=>{const g=document.createElement("tr");let p="",t="";if(i==="top_systems"){const o=n.solar_system_name||"UNKNOWN";p=`<span class="clickable-system" data-system="${o}" title="Click to search for ${o}">${o}<i class="fa-sharp fa-solid fa-arrow-up-right-from-square"></i></span>`,t=n.incident_count||n.kills}else if(i==="top_killers"){const o=n.name||"UNKNOWN";p=`<span class="clickable-name" data-name="${o}" title="Click to search for ${o}">${o}<i class="fa-sharp fa-solid fa-arrow-up-right-from-square"></i></span>`,t=n.kills}else if(i==="top_victims"){const o=n.name||"UNKNOWN";p=`<span class="clickable-name" data-name="${o}" title="Click to search for ${o}">${o}<i class="fa-sharp fa-solid fa-arrow-up-right-from-square"></i></span>`,t=n.losses}else if(i==="top_tribes"){const o=n.tribe_name||"UNKNOWN";p=`<span class="clickable-tribe" data-tribe="${o}" title="Click to search for ${o}">${o}<i class="fa-sharp fa-solid fa-arrow-up-right-from-square"></i></span>`,t=n.total_kills+n.total_losses}g.innerHTML=`
                <td>${p}</td>
                <td>${t}</td>
            `,a.appendChild(g)}):r&&(r.innerHTML=`<p data-translate="error.noData">${((m=s["error.noData"])==null?void 0:m[localStorage.getItem("preferredLanguage")||"en"])||"No data available for this metric."}</p>`,l.style.display="none"),A(l.id),typeof v=="function"&&v(localStorage.getItem("preferredLanguage")||"en")}function A(e){const l=document.getElementById(e);if(!l){console.error(`Table with ID ${e} not found.`);return}[...l.querySelectorAll(".clickable-name")].map(a=>{a.style.cursor="pointer",a.addEventListener("click",i=>{i.preventDefault();const r=a.dataset.name;r&&r!=="UNKNOWN"&&typeof u=="function"?u(r,"name"):typeof u!="function"&&console.error("navigateToSearch function is not defined. Make sure utils.js is loaded.")})}),[...l.querySelectorAll(".clickable-system")].map(a=>{a.style.cursor="pointer",a.addEventListener("click",i=>{i.preventDefault();const r=a.dataset.system;r&&r!=="UNKNOWN"&&typeof u=="function"?u(r,"system"):typeof u!="function"&&console.error("navigateToSearch function is not defined. Make sure utils.js is loaded.")})}),[...l.querySelectorAll(".clickable-tribe")].map(a=>{a.style.cursor="pointer",a.addEventListener("click",i=>{i.preventDefault();const r=a.dataset.tribe;r&&r!=="UNKNOWN"&&typeof u=="function"?u(r,"tribe"):typeof u!="function"&&console.error("navigateToSearch function is not defined. Make sure utils.js is loaded.")})})}export{D as f,I as u};
