import{b as M,l as v,i as x,e as D,h as C,g as $,s as I,t as S,a as L,j as A,k as F,m as P,n as R}from"./common-CKLXUwgl.js";let d=null;const e=(t,l="",n={})=>{var a,m;const o=$[A];let i=((a=S[t])==null?void 0:a[o])||((m=S[t])==null?void 0:m.en)||l||t;for(const c in n)i=i.replace(new RegExp(`{${c}}`,"g"),n[c]);return i},u=(t,l)=>t==null||typeof t=="string"&&t.trim()===""?e(`general.${l.toLowerCase()}`,l):String(t);function E(t,l){const n=document.createElement("div");n.className=`combatant-column-km ${l}-column`;const o=document.createElement("div");o.className=`combatant-card-km ${l}-card-km`;const i=document.createElement("div");i.className="combatant-header-km";const a=document.createElement("img");a.className="profile-image",a.alt=e(`altText.${l}Image`,`${l} ${t.name}`,{name:t.name}),a.src=F(t.portrait_url,"../");const m=document.createElement("div");m.className="combatant-info-km";const c=document.createElement("h3");c.className=`combatant-role-label ${l}`,c.textContent=e(`killmail.${l}Label`,l.toUpperCase());const r=document.createElement("h2");r.className=`${l} clickable-name`,r.dataset.name=t.name,r.title=e("tooltip.searchFor","Search for {itemName}",{itemName:t.name}),r.textContent=t.name;const s=document.createElement("p");s.innerHTML=`${e("killmail.corporationLabel","Corporation:")} <span class="placeholder">${e(`killmail.placeholder.${l}Corp`,`[${l} Corp Placeholder]`)}</span>`;const h=document.createElement("p"),p=l==="victim"&&(t.loss_type==="ship"||t.loss_type==="pod")?t.loss_type:e(`killmail.placeholder.${l}Ship`,`[${l} Ship Placeholder]`);return h.innerHTML=`${e("killmail.shipLabel","Ship:")} <span class="placeholder">${p}</span>`,m.appendChild(c),m.appendChild(r),m.appendChild(s),m.appendChild(h),i.appendChild(a),i.appendChild(m),o.appendChild(i),n.appendChild(o),n}function K(t){const l=document.createElement("div");l.className="engagement-details-km data-card";const n=document.createElement("h3");n.textContent=e("killmail.engagementDetailsTitle","Engagement Details");const o=document.createElement("p");o.innerHTML=`<strong>${e("killmail.lossTypeLabel","Loss Type:")}</strong> ${t.loss_type}`;const i=document.createElement("p");i.innerHTML=`<strong>${e("killmail.timeLabel","Time:")}</strong> ${P(t.time_stamp,R)}`;const a=document.createElement("p"),m=document.createElement("span");return m.className="clickable-system",m.dataset.system=t.solar_system_name,m.title=e("tooltip.searchFor","Search for {itemName}",{itemName:t.solar_system_name}),m.textContent=t.solar_system_name,a.innerHTML=`<strong>${e("killmail.locationLabel","Location:")}</strong> `,a.appendChild(m),a.innerHTML+=` (${e("card.idLabel","ID:")} ${t.solar_system_id})`,l.appendChild(n),l.appendChild(o),l.appendChild(i),l.appendChild(a),l}function B(t,l,n){const o=document.createElement("details");o.className="fitting-category",o.setAttribute("open","");const i=document.createElement("summary");i.innerHTML=`<i class="fas fa-${l}"></i> ${t}`;const a=document.createElement("ul");return n.forEach(m=>{const c=document.createElement("li"),r=document.createElement("span");r.className="placeholder",r.textContent=m,c.appendChild(r),a.appendChild(c)}),o.appendChild(i),o.appendChild(a),o}function O(){const t=document.createElement("div");t.className="fitting-section-km data-card";const l=document.createElement("h3");l.textContent=e("killmail.fittingTitle","Ship Fitting & Contents");const n=document.createElement("p");n.className="note",n.innerHTML=`<i class="fas fa-info-circle"></i> ${e("killmail.fittingNote","Note: Fitting data is placeholder.")}`;const o=document.createElement("div");return o.className="fitting-table-km",[{title:e("killmail.fitting.highSlots","High Slots"),icon:"crosshairs",items:[e("killmail.placeholder.highSlotItem1","[High Slot Item 1]"),e("killmail.placeholder.highSlotItem2","[High Slot Item 2]"),e("killmail.placeholder.emptyHighSlot","[Empty High Slot]")]},{title:e("killmail.fitting.midSlots","Mid Slots"),icon:"shield-alt",items:[e("killmail.placeholder.midSlotItem1","[Mid Slot Item 1]"),e("killmail.placeholder.midSlotItem2","[Mid Slot Item 2]"),e("killmail.placeholder.midSlotItem3","[Mid Slot Item 3]")]},{title:e("killmail.fitting.lowSlots","Low Slots"),icon:"cogs",items:[e("killmail.placeholder.lowSlotItem1","[Low Slot Item 1]"),e("killmail.placeholder.lowSlotItem2","[Low Slot Item 2]"),e("killmail.placeholder.lowSlotItem3","[Low Slot Item 3]")]},{title:e("killmail.fitting.rigs","Rigs"),icon:"microchip",items:[e("killmail.placeholder.rigSlotItem1","[Rig Slot Item 1]"),e("killmail.placeholder.rigSlotItem2","[Rig Slot Item 2]"),e("killmail.placeholder.rigSlotItem3","[Rig Slot Item 3]")]},{title:e("killmail.fitting.drones","Drones"),icon:"fighter-jet",items:[e("killmail.placeholder.droneItem1","[Drone Item 1]"),e("killmail.placeholder.droneItem2","[Drone Item 2]")]},{title:e("killmail.fitting.ammoCharges","Ammunition / Charges"),icon:"cubes",items:[e("killmail.placeholder.ammoItem1","[Ammo Item 1]"),e("killmail.placeholder.ammoItem2","[Ammo Item 2]"),e("killmail.placeholder.ammoItem3","[Ammo Item 3]")]},{title:e("killmail.fitting.cargoHold","Cargo Hold"),icon:"box-open",items:[e("killmail.placeholder.cargoItem1","[Cargo Item 1]"),e("killmail.placeholder.cargoItem2","[Cargo Item 2]"),e("killmail.placeholder.cargoItem3","[Cargo Item 3]")]}].forEach(a=>{o.appendChild(B(a.title,a.icon,a.items))}),t.appendChild(l),t.appendChild(n),t.appendChild(o),t}function T(t){const l=document.getElementById("killmail-content"),n=document.getElementById("killmail-page-title-container"),o=document.querySelector("title");if(!l||!n||!o){console.error("One or more essential DOM elements for killmail detail page are missing."),l&&(l.innerHTML=`<p class="error">${e("error.generic","An error occurred.")}</p>`);return}if(!t){l.innerHTML=`<p class="error">${e("error.killmailLoadFailed","Killmail data is not available to render.")}</p>`;return}const i=u(t.victim_name,"unknown"),a=u(t.killer_name,"notApplicable"),m=u(t.solar_system_name,"unknown"),c=u(t.loss_type,"classified");u(t.solar_system_id,"notApplicable"),o.textContent=e("killmail.pageTitlePattern","Killmail: {killerName} vs {victimName}",{killerName:a,victimName:i});const r=document.createElement("h1"),s=document.createElement("span");s.className="killer clickable-name",s.dataset.name=a,s.title=e("tooltip.searchFor","Search for {itemName}",{itemName:a}),s.textContent=a;const h=document.createElement("span");h.className="text-primary",h.textContent=` ${e("killmail.headerVs","vs")} `;const p=document.createElement("span");p.className="victim clickable-name",p.dataset.name=i,p.title=e("tooltip.searchFor","Search for {itemName}",{itemName:i}),p.textContent=i,r.appendChild(s),r.appendChild(h),r.appendChild(p);const k=document.createElement("p");k.className="system-location";const b=document.createTextNode(`${e("killmail.headerIncidentIn","Incident in")} `),g=document.createElement("span");g.className="clickable-system",g.dataset.system=m,g.title=e("tooltip.searchFor","Search for {itemName}",{itemName:m}),g.textContent=m,k.appendChild(b),k.appendChild(g),n.innerHTML="",n.appendChild(r),n.appendChild(k);const f=document.createElement("div");f.className="combatants-grid-km";const _={name:a,loss_type:c,portrait_url:t.killer_portrait_url},w={name:i,loss_type:c,portrait_url:t.victim_portrait_url};f.appendChild(E(_,"killer")),f.appendChild(E(w,"victim"));const y=K(t),H=O();l.innerHTML="",l.appendChild(f),l.appendChild(y),l.appendChild(H),typeof L=="function"&&L()}async function N(){const l=new URLSearchParams(window.location.search).get("mail_id"),n=document.getElementById("killmail-content");if(!n){console.error("killmail-content element not found in DOM.");return}if(l)try{if(!d||d.id!==Number.parseInt(l)){const i=await D(l);if(!i||i.length===0)throw C(),new Error(e("error.killmailNotFound","Killmail not found."));d=i[0]}T(d)}catch(i){console.error("Failed to load killmail data from API:",i),d=null,n.innerHTML=`<p class="error">${e("error.killmailLoadFailedApi",i.message||"Failed to load killmail data from API.")}</p>`}else d=null,n.innerHTML=`<p class="error">${e("error.noKillmailId","No killmail ID provided in URL.")}</p>`;const o=localStorage.getItem("preferredLanguage")||$[0];typeof I=="function"&&I(o),C()}document.addEventListener("DOMContentLoaded",async()=>{M(),await v(),x("killmail_detail"),await N(),typeof window.AlphaStrike>"u"&&(window.AlphaStrike={}),window.AlphaStrike.onLanguageChangeRenderContent=()=>{console.log("Killmail page: Language change detected, re-rendering content."),d?T(d):N()}});
